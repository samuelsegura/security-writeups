================================
LAB: DOM XSS in document.write sink using source location.search
================================

[LAB INFORMATION]
-----------------
Date: 2026-02-24
Lab URL: https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-document-write-sink
Category: XSS - DOM Based
Level: Apprentice
Objective: Perform a DOM XSS attack that calls the alert() function.
Description: The search query tracking feature uses document.write() with data from location.search, allowing attacker-controlled input to be written directly into the DOM.

[RECONNAISSANCE]
----------------
- Searched for unique string "AAABBBCCC" via the search bar.
- Inspected the live DOM via Firefox DevTools (Inspector tab) — NOT View Source.
- Found input reflected inside an <img> tag attribute:
  <img src="/resources/images/tracker.gif?searchTerms=AAABBBCCC">
- Context: input lands inside the src attribute value of a <img> tag, generated by document.write().

[VULNERABILITY DISCOVERY]
-------------------------
- No sanitization applied to location.search before it is passed to document.write().
- Input is written verbatim into the HTML, inside an attribute value.
- Injecting quote + angle bracket allows breaking out of the attribute and the tag.

[EXPLOITATION]
--------------
Payload: AAABBBCCC"><script>alert(1)</script>

Steps:
1. Type payload directly in the search bar.
2. The document.write() call produces:
   <img src="/resources/images/tracker.gif?searchTerms=AAABBBCCC">
   <script>alert(1)</script>
3. Browser executes the injected <script> tag → alert(1) fires.

Note: The > must be placed immediately after the " (no space), otherwise the browser
parses <script as an attribute name of <img> instead of a new tag.

[EVIDENCE]
----------
- alert(1) dialog triggered in the browser after submitting the payload.
- Lab banner updated to "Congratulations, you solved the lab!"

[LESSONS LEARNED]
-----------------
- document.write() is a dangerous sink: unlike innerHTML, it DOES execute injected <script> tags.
- Always inspect the live DOM (DevTools Inspector) when hunting DOM XSS — View Source shows pre-JS HTML only.
- Context matters: identify WHERE your input lands (attribute, tag, text node) before crafting a payload.
- A single misplaced space can break a payload (" <script>" vs "><script>").
- Source → Sink flow with no sanitization = exploitable DOM XSS regardless of server-side protections.